<div *ngIf="isLoading" class="loader"><mat-spinner></mat-spinner></div>
<div *ngIf="issues" class="open-sans issue-tab">
  <div class="issue-list">
    <div class="category-issue" *ngFor="let checkpoint of (issues | keyvalue)">
      <h1 class="checkpoint-name" id="{{ checkpoint.key.replace(' ', '-') }}">{{ checkpoint.key }}</h1>
      <mat-accordion>
        <section *ngFor="let issue of checkpoint.value">
          <mat-expansion-panel
            [expanded]="false"
            hideToggle
            *ngIf="issue.is_resolved"
            class="issue-expansion open-sans"
          >
            <mat-expansion-panel-header>
              <mat-panel-title> Issue # {{ issue.id }} </mat-panel-title>
              Resolved<mat-icon>done</mat-icon>
            </mat-expansion-panel-header>
            <td-markdown> {{ issue.description }} </td-markdown>
            <mat-action-row>
              <button mat-button color="warn" (click)="issueResolution(issue.id, false, checkpoint.key)">
                Mark as Unresolved
              </button>
            </mat-action-row>
          </mat-expansion-panel>
        </section>
      </mat-accordion>

      <mat-accordion>
        <section *ngFor="let issue of checkpoint.value">
          <mat-expansion-panel
            [expanded]="true"
            hideToggle
            *ngIf="!issue.is_resolved"
            class="issue-expansion open-sans"
          >
            <mat-expansion-panel-header>
              <mat-panel-title> Issue # {{ issue.id }} </mat-panel-title>
              Not Resolved<mat-icon>clear</mat-icon>
            </mat-expansion-panel-header>
            <td-markdown> {{ issue.description }} </td-markdown>
            <app-comments [activityId]="issue.id" [activityType]="'issue'"></app-comments>
            <mat-action-row>
              <button mat-button color="primary" (click)="issueResolution(issue.id, true, checkpoint.key)">
                Mark as Resolved
              </button>
            </mat-action-row>
          </mat-expansion-panel>
        </section>
      </mat-accordion>
    </div>
  </div>
  <div class="checkpoint-nav flex-1">
    <div class="nav-container">
      <h2 class="checkpoint-nav-name">Issue Categories</h2>
      <div *ngFor="let checkpoint of (issues | keyvalue)">
        <a class="pointer checkpoint-nav-name" (click)="scrollToCheckpoint(checkpoint.key.replace(' ', '-'))">{{
          checkpoint.key
        }}</a>
      </div>
    </div>
  </div>
</div>
